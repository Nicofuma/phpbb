services:
    security.login_controller:
        class: phpbb\security\controller\login_controller
        arguments:
            - '@security.authentication_utils'
            - '@security.token_storage'
            - '@controller.helper'
            - '@language'
            - '@template'

    security.confirm_password_controller:
        class: phpbb\security\controller\confirm_password_controller
        arguments:
            - '@security.authentication_utils'
            - '@security.token_storage'
            - '@controller.helper'
            - '@language'
            - '@template'
            - '@passwords.manager'

    security.guard.form_login_authenticator:
        class: phpbb\security\guard\form_login_authenticator
        arguments:
            - '@routing.helper'
            - '@passwords.manager'

    security.user_provider.phpbb_database:
        class: phpbb\security\user\phpbb_database_provider
        arguments:
            - '@user_loader'

    security.firewall:
        class: phpbb\security\firewall
        arguments:
            - '@security.firewall.map'
            - '@event_dispatcher'
        tags:
            - { name: kernel.event_subscriber }

    security.authentication.trust_resolver:
        class: phpbb\security\authentication_trust_resolver
        arguments:
            - '@security.acl.provider'
            - '%security.authentication.trust_resolver.anonymous_class%'
            - '%security.authentication.trust_resolver.rememberme_class%'

# ----- Event listeners -----
    security.access.listener.re_authenticated_listener:
        class: phpbb\security\listener\re_authenticated_listener
        arguments:
            - '@security.token_storage'
            - '@security.access.decision_manager'
            - '@routing.helper'
            - '@?logger'
        tags:
            - { name: kernel.event_subscriber }
            - { name: monolog.logger, channel: security }

# ----- Security listeners -----
    security.authentication.listener.anonymous:
        class: phpbb\security\listener\anonymous_authentication_listener
        public: false
        arguments:
            - '@security.token_storage'
            - ~
            - '@user_helper'
            - '@?logger'
            - '@security.authentication.manager'
        tags:
            - { name: monolog.logger, channel: security }

    security.access_listener:
        class: Symfony\Component\Security\Http\Firewall\AccessListener
        arguments:
            - '@security.token_storage'
            - '@security.access.decision_manager'
            - '@security.access_map'
            - '@security.authentication.manager'
        tags:
            - { name: monolog.logger, channel: security }

# ----- Acl -----
    security.acl.checker:
        class: phpbb\security\acl\acl_checker
        arguments:
            - '@security.acl.provider'

    security.acl.provider:
        class: phpbb\security\acl\acl_provider
        arguments:
            - '@dbal.conn'
            - '@cache.driver'

# ----- Voters -----
    security.voter.re_authenticated_voter:
        class: phpbb\security\voter\re_authenticated_voter
        public: false
        arguments:
            - '@security.authentication.trust_resolver'
        tags:
            - { name: security.voter, priority: 250 }
